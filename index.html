<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>물고임 지도 (시범 - Leaflet)</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
        "Apple SD Gothic Neo", "맑은 고딕", sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .panel {
      position: absolute;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.18);
      padding: 14px 18px;
      font-size: 13px;
      z-index: 1000;
    }
    .panel-left {
      top: 14px;
      left: 14px;
      max-width: 260px;
    }
    .panel-right {
      right: 14px;
      bottom: 14px;
      max-width: 260px;
    }
    .panel-left h1 {
      margin: 0 0 4px 0;
      font-size: 16px;
      line-height: 1.3;
    }
    .panel-left .subtitle {
      margin: 0 0 10px 0;
      font-size: 11px;
      color: #777;
    }
    .legend {
      border-top: 1px solid #eee;
      border-bottom: 1px solid #eee;
      padding: 8px 0;
      margin: 6px 0 8px 0;
    }
    .legend-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 12px;
    }
    .legend-item {
      display: flex;
      align-items: flex-start;
      margin: 6px 0;
      font-size: 12px;
      line-height: 1.4;
      word-break: keep-all;
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      border: 1px solid #fff;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
      margin-top: 4px;
    }
    .dot-green { background: #2ecc71; }
    .dot-yellow { background: #f1c40f; }
    .dot-red { background: #e74c3c; }

    .desc {
      font-size: 11px;
      color: #666;
    }
    .btn {
      width: 100%;
      border: none;
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 6px;
    }
    .btn.primary {
      background: #2e86de;
      color: #fff;
    }
    .btn.primary:hover {
      background: #1b69b6;
    }
    .btn.secondary {
      background: #f5f6fa;
      color: #444;
    }
    .btn.secondary:hover {
      background: #eaecef;
    }
    .hint {
      font-size: 10px;
      color: #888;
      margin: 4px 0 0 0;
      line-height: 1.4;
    }

    /* 팝업창 스타일 개선 */
    .leaflet-popup-content-wrapper {
      border-radius: 12px;
      padding: 0;
    }
    .leaflet-popup-content {
      margin: 14px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="panel panel-left">
    <h1>대전 유성구<br>물고임 지도(시범)</h1>
    <p class="subtitle">충남대학교 정문 일대 · 테스트 버전</p>

    <div class="legend">
      <div class="legend-title">위험 등급 기준</div>
      
      <div class="legend-item">
        <span class="dot dot-green"></span>
        <span>
          <strong>녹색 (양호):</strong> 물고임이 있지만 보행 폭이 1.5m 이상 확보되어 통행에 지장이 적은 곳.
        </span>
      </div>
      
      <div class="legend-item">
        <span class="dot dot-yellow"></span>
        <span>
          <strong>노란색 (주의):</strong> 보행 폭 1.2~1.5m 수준, 신발이 젖을 정도의 불편함이 있어 주의가 필요한 곳.
        </span>
      </div>
      
      <div class="legend-item">
        <span class="dot dot-red"></span>
        <span>
          <strong>빨간색 (위험):</strong> 보행 유효 폭이 1.2m 미만으로 줄어들어 휠체어 통행이 불가능하거나, 수심이 깊어(5cm 이상) 우회가 필수적인 곳.
        </span>
      </div>
    </div>
    <div class="desc">
      · 마커를 클릭하면 <strong>예시 지점 정보</strong>가 나타납니다.<br>
      · 실제 데이터가 아니라 <strong>프로토타입 화면</strong>입니다.
    </div>
  </div>

  <div class="panel panel-right">
    <a
      href="https://docs.google.com/forms/d/e/1FAIpQLSfvimfliYduITaQSWFbSHtYwMRCicafjd5T5TTL2191_UZPWg/viewform?usp=header"
      target="_blank"
      class="btn primary"
      style="display:block; text-align:center; text-decoration:none;"
    >
      사진 찍어서 제보하기
    </a>

    <button class="btn secondary" onclick="openContact()">
      담당자에게 문의하기
    </button>
    <p class="hint">
      * 제보하기 버튼은 구글폼 또는 학교 설문 링크에 연결할 수 있습니다.<br>
      * 문의하기는 학과·팀 이메일 등으로 연결합니다.
    </p>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // 1. 지도 기본 설정 (충남대 정문 근처 좌표)
    var map = L.map('map').setView([36.3660, 127.3445], 16);

    // 2. 타일 레이어 (OpenStreetMap 사용)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 3. 실제 현장 물고임 지점 데이터 (파일명 캡처본 기준 수정 완료)
    var puddles = [
      {
        id: 1,
        name: "무모한초밥 앞 물 웅덩이",
        lat: 36.357698,
        lng: 127.342688,
        severity: "green",
        pond_width_m: 8.15,
        pond_length_m: 3.66,
        depth_cm: 8,
        note: "보도 전체 폭에 가까운 물고임이 형성되어 보행자가 우회해야 하는 지점.",
        photo: [
          "puddle_1_1.jpg",
          "puddle_1_2_축소.jpg"
        ]
      },
      {
        id: 2,
        name: "심청아 배고파 앞",
        lat: 36.358034,
        lng: 127.342882,
        severity: "red",
        pond_width_m: 4.5,
        pond_length_m: 4.5,
        depth_cm: 2,
        note: "가게 앞 전체 통행 불편",
        photo: [
          "puddle_2_1.jpg",
          "puddle_2_2.jpg"
        ]
      },
      {
        id: 3,
        name: "세븐일레븐 앞 횡단보도",
        lat: 36.358643,
        lng: 127.343072,
        severity: "red",
        pond_width_m: 4.6,
        pond_length_m: 2.54,
        depth_cm: 3,
        note: "횡단보도 중 웅덩이로 사고 위험 높음",
        photo: [
          "puddle_3_1.jpg",
          "puddle_3_2.jpg"
        ]
      },
      {
        id: 4,
        name: "아랑횟집 앞",
        lat: 36.359201,
        lng: 127.344229,
        severity: "yellow",
        pond_width_m: 1.4,
        pond_length_m: 1.2,
        depth_cm: 4,
        note: "전체 길 폭 2.6m 중 길 가운데에 웅덩이로 휠체어 최소 폭 확보 불가",
        photo: [
          "puddle_4_1_축소.jpg"
        ]
      },
      {
        id: 5,
        name: "아랑횟집 뒤",
        lat: 36.359188,
        lng: 127.344368,
        severity: "green",
        pond_width_m: 1.1,
        pond_length_m: 1.3,
        depth_cm: 3,
        note: "전체 길 폭 2.6m 중 길 가운데에 하수구 단차로 인한 웅덩이 형성, 휠체어 최소 폭 확보 불가",
        photo: [
          "puddle_5_1_축소.jpg"
        ]
      },
      {
        id: 6,
        name: "불이야 앞",
        lat: 36.359025,
        lng: 127.345156,
        severity: "green",
        pond_width_m: 1.1,
        pond_length_m: 0.75,
        depth_cm: 3,
        note: "전체 길 폭 2.6m 중 길 가운데에 웅덩이로 휠체어 최소 폭 확보 불가",
        photo: [
          "puddle_6_1_축소.jpg"
        ]
      },
      {
        id: 7,
        name: "상하이 앞",
        lat: 36.359042,
        lng: 127.345514,
        severity: "red",
        pond_width_m: 0.8,
        pond_length_m: 1.2,
        depth_cm: 5,
        note: "전체 길 폭 2.6m 중 길 가운데에 상대적으로 깊은 웅덩이로 비 그친 뒤에도 물고임 지속 우려, 휠체어 최소 폭 확보 불가",
        photo: [
          "puddle_7_1.jpg"
        ]
      },
      {
        id: 8,
        name: "동큐칼국수 앞",
        lat: 36.360731,
        lng: 127.341957,
        severity: "yellow",
        pond_width_m: 0.54,
        pond_length_m: 0.63,
        depth_cm: 5,
        note: "전체 길 폭 4.4m, 배수구 바로 옆이지만 웅덩이가 깊고 단차까지 존재하여 배수불량 발생",
        photo: [
          "puddle_8_1.jpg"
        ]
      },
      {
        id: 9,
        name: "정통집 맞은편",
        lat: 36.362703,
        lng: 127.349753,
        severity: "green",
        pond_width_m: 2.34,
        pond_length_m: 0.5,
        depth_cm: 3,
        note: "전체 길 폭 3.8m, 차도와 구분 모호한 구역인데 차 오면 통행 불편",
        photo: [
          "puddle_9_1_축소.jpg"
        ]
      },
      {
        id: 10,
        name: "아임일리터 앞",
        lat: 36.361796,
        lng: 127.350365,
        severity: "yellow",
        pond_width_m: 1.38,
        pond_length_m: 0.47,
        depth_cm: 4,
        note: "도로 마모로 인한 웅덩이",
        photo: [
          "puddle_10_1.jpg"
        ]
      },
      {
        id: 11,
        name: "공5 뒤",
        lat: 36.36662,
        lng: 127.344762,
        severity: "green",
        pond_width_m: 2.0,
        pond_length_m: 2.0,
        depth_cm: 3,
        note: "단차 때문에 물고임 발생",
        photo: [
          "puddle_11_1.jpg"
        ]
      }
    ];
      
    function getColor(sev) {
      if (sev === "red") return "#e74c3c";
      if (sev === "yellow") return "#f1c40f";
      return "#2ecc71"; // green
    }

    // 4. 마커 + 팝업 생성
    puddles.forEach(function (p) {
      var marker = L.circleMarker([p.lat, p.lng], {
        radius: 8,
        color: "#ffffff",
        weight: 2,
        fillColor: getColor(p.severity),
        fillOpacity: 1
      }).addTo(map);

      var severityLabel =
        p.severity === "red" ? "최우선 개선" :
        p.severity === "yellow" ? "우선 개선" : "관찰 필요";

      var photoCount = 0;
      if (p.photo) {
        photoCount = Array.isArray(p.photo) ? p.photo.length : 1;
      }

      var popupWidth = photoCount >= 2 ? 460 : 300;

      var popupHtml =
        '<div style="width:' + popupWidth + 'px; font-size:13px;">' +
          '<h3 style="margin:0 0 6px 0; font-size:16px;">' + p.name + '</h3>' +
          '<div>위험 등급: <b>' + severityLabel + '</b></div>' +
          '<div>웅덩이 크기: ' + p.pond_width_m + 'm × ' + p.pond_length_m + 'm</div>' +
          '<div>수심: ' + p.depth_cm + 'cm</div>' +
          '<div style="margin-top:8px; color:#444; background:#f5f6fa; padding:8px; border-radius:6px;">' + 
             p.note + 
          '</div>';

      if (p.photo) {
        var photos = Array.isArray(p.photo) ? p.photo : [p.photo];
        
        popupHtml += '<div style="margin-top:10px; display:flex; gap:8px;">';

        photos.slice(0, 2).forEach(function (src) {
          popupHtml +=
            '<div style="flex:1;">' +
              '<img src="' + src + '" ' +
                   'style="width:100%; height:auto; border-radius:8px; border:1px solid #eee; display:block; object-fit:cover; aspect-ratio: 4/3;" />' +
            '</div>';
        });

        popupHtml += '</div>';
      }
      popupHtml += '</div>';

      marker.bindPopup(popupHtml, { maxWidth: 600 });
    });

    function openReportForm() {
      var url = "https://docs.google.com/forms/d/e/1FAIpQLSfvimfliYduITaQSWFbSHtYwMRCicafjd5T5TTL2191_UZPWg/viewform?usp=header";
      window.open(url, "_blank");
    }

    function openContact() {
      var email = "team.puddle@cnu.ac.kr";
      var subject = encodeURIComponent("[물고임 지도] 문의 드립니다.");
      var body = encodeURIComponent("내용을 입력해 주세요.");
      window.location.href = "mailto:" + email +
        "?subject=" + subject +
        "&body=" + body;
    }
  </script>
</body>
</html>
